steps:
  - checkout

  - name: Install JDK
    run: sudo apt-get update && sudo apt-get install -y openjdk-11-jdk

  - name: Install Android SDK tools
    run: |
      export ANDROID_SDK_ROOT=$HOME/android-sdk
      mkdir -p $ANDROID_SDK_ROOT/cmdline-tools
      curl -sSL https://dl.google.com/android/repository/commandlinetools-linux-9477386_latest.zip -o cmdline.zip
      unzip -q cmdline.zip -d $ANDROID_SDK_ROOT/cmdline-tools
      mv $ANDROID_SDK_ROOT/cmdline-tools/cmdline-tools $ANDROID_SDK_ROOT/cmdline-tools/latest
      yes | sdkmanager --sdk_root=$ANDROID_SDK_ROOT --licenses
      sdkmanager --sdk_root=$ANDROID_SDK_ROOT "platform-tools" "build-tools;33.0.0" "platforms;android-33"

  - name: Generate local.properties
    run: echo "sdk.dir=$HOME/android-sdk" > android/local.properties

  - name: Build APK
    working-directory: android
    run: ./gradlew clean assembleDebug --no-daemon
